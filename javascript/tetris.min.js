(function(){("undefined"!=typeof exports&&null!==exports?exports:this).tetris=function(){var $CONTAINER,CANVAS,CELL_PADDING,CELL_SIZE,COLOURS,CONTEXT,GAMES,GAMES_PER_ROW,GAME_HEIGHT,GAME_WIDTH,INFO_HEIGHT,POPULATION_SIZE,ROWS,best,init,kill,toUpdate,update,_move,_resize;return COLOURS=[null,"#000000","#222222","#444444","#666666","#888888","#AAAAAA","#CCCCCC"],$CONTAINER=CANVAS=GAMES=CONTEXT=GAME_WIDTH=GAME_HEIGHT=CELL_PADDING=CELL_SIZE=INFO_HEIGHT=null,POPULATION_SIZE=32,GAMES_PER_ROW=12,ROWS=3,best=null,toUpdate=[],_resize=function(){return CANVAS.width=$CONTAINER.innerWidth()-50,CANVAS.height=$CONTAINER.innerHeight()-50,GAME_WIDTH=CANVAS.width/GAMES_PER_ROW,CELL_PADDING=10,CELL_SIZE=(GAME_WIDTH-2*CELL_PADDING)/10,GAME_HEIGHT=20*CELL_SIZE,GAME_HEIGHT+=(CANVAS.height-ROWS*GAME_HEIGHT)/ROWS},_move=function(tetris,index){return null===best?(best=tetris,best.index=index+1,best.generation=Genie.getGeneration()):tetris.score>best.score&&(best=tetris,best.index=index+1,best.generation=Genie.getGeneration()),toUpdate.push({tetris:tetris,index:index})},init=function($container){return $CONTAINER=$container,$CONTAINER.empty(),CANVAS=$("<canvas>").get(0),$CONTAINER.append(CANVAS),CONTEXT=CANVAS.getContext("2d"),$(window).resize(_resize),_resize(),Genie.init({evaluateFitness:function(chromosome,chromosomeIndex){var tetris,update;return tetris=new TetrisAI(chromosome.genes),update=function(){return tetris.gameOver()?Genie.reportFitness(tetris.score,chromosomeIndex):(_move(tetris,chromosomeIndex),tetris.makeMove(),requestAnimFrame(update))},update()},logging:!0,numberOfGenes:8,useWorkers:!1}),Genie.run()},update=function(){var fillX,fillY,game,value,x,xIndex,y,yIndex,_i,_j,_k,_len;for(_i=0,_len=toUpdate.length;_len>_i;_i++)if(game=toUpdate[_i],xIndex=game.index%GAMES_PER_ROW,yIndex=Math.floor(game.index/GAMES_PER_ROW),CONTEXT.clearRect(xIndex*GAME_WIDTH+CELL_PADDING,yIndex*GAME_HEIGHT+CELL_PADDING,GAME_WIDTH,GAME_HEIGHT),CONTEXT.fillStyle="rgba(0, 0, 0, 0.1)",CONTEXT.fillRect(xIndex*GAME_WIDTH+CELL_PADDING,yIndex*GAME_HEIGHT+CELL_PADDING,10*CELL_SIZE,20*CELL_SIZE),null!=game.tetris){for(x=_j=0;10>_j;x=++_j)for(y=_k=0;20>_k;y=++_k)value=game.tetris.grid[y+1][x+1],0!==value&&8!==value&&9!==value&&-2!==value&&-3!==value&&(CONTEXT.fillStyle=COLOURS[value],fillX=x*CELL_SIZE+1+xIndex*GAME_WIDTH+CELL_PADDING,fillY=y*CELL_SIZE+1+yIndex*GAME_HEIGHT+CELL_PADDING,CONTEXT.fillRect(fillX,fillY,CELL_SIZE-2,CELL_SIZE-2));game.update=!1,CONTEXT.font="bold 30px College",CONTEXT.fillStyle="#444499",CONTEXT.fillText(game.index+1,xIndex*GAME_WIDTH+CELL_PADDING+5,yIndex*GAME_HEIGHT+CELL_PADDING+25),CONTEXT.font="bold 15px College",CONTEXT.fillStyle="#44BB44",CONTEXT.fillText(game.tetris.score,xIndex*GAME_WIDTH+CELL_PADDING+5,yIndex*GAME_HEIGHT+CELL_PADDING+50)}return toUpdate=[],best?(CONTEXT.font="bold 30px College",CONTEXT.clearRect(8*GAME_WIDTH,2*(GAME_HEIGHT+INFO_HEIGHT),400,150),CONTEXT.fillStyle="#444499",CONTEXT.fillText("BEST SCORE: ",8*GAME_WIDTH+10,2*GAME_HEIGHT+30),CONTEXT.fillText("GENERATION: ",8*GAME_WIDTH+10,2*GAME_HEIGHT+70),CONTEXT.fillText("CANDIDATE: ",8*GAME_WIDTH+10,2*GAME_HEIGHT+110),CONTEXT.fillStyle="#449944",CONTEXT.fillText((null!=best?best.score:void 0)||"",8*GAME_WIDTH+200,2*GAME_HEIGHT+30),CONTEXT.fillText((null!=best?best.generation:void 0)||"",8*GAME_WIDTH+200,2*GAME_HEIGHT+70),CONTEXT.fillText((null!=best?best.index:void 0)||"",8*GAME_WIDTH+200,2*GAME_HEIGHT+110)):void 0},kill=function(){return Genie.kill()},{init:init,update:update,kill:kill}}()}).call(this);